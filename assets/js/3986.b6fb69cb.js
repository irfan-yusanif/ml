"use strict";(self.webpackChunkdyte_docs=self.webpackChunkdyte_docs||[]).push([["3986"],{15103:function(e,t,i){i.r(t),i.d(t,{dyte_audio_visualizer:function(){return o},dyte_switch:function(){return h}});var a=i(84982),s=i(40566),n=i(48724),r=i(83041);let c=(e,t)=>{if(null==e)return;let i=Math.round(1.5),a=[...[,,,]].map((e,a)=>{let s=a;return s>i-1&&(s=3-s-1),Math.round((s+1)/(i+1)*t)}),{width:s,height:n}=e,r=e.getContext("2d"),c=2,o=1*s/a.length,h=o-4;r.clearRect(0,0,s,n),r.fillStyle="rgb(0,0,0,0.0)",r.fillRect(0,0,s,n);let l=getComputedStyle(e).getPropertyValue("color");for(let e of(r.fillStyle=l,r.strokeStyle=l,r.lineCap="round",r.lineWidth=4,r.beginPath(),a)){let t=Math.min(-Math.abs(1.2*e/10*n)+n/2,n/2-2.5),i=Math.max((n/2-t)*2,5);r.moveTo(c+h/2,t),r.lineTo(c+h/2,t+i),c+=o}r.stroke()},o=class{constructor(e){(0,a.r)(this,e),this.variant="bars",this.participant=void 0,this.size=void 0,this.iconPack=n.d,this.t=(0,r.u)(),this.isScreenShare=!1,this.audioEnabled=void 0,this.volume=0}connectedCallback(){this.participantChanged(this.participant)}componentDidLoad(){c(this.visualizer,0)}disconnectedCallback(){var e,t,i;null===(e=this.hark)||void 0===e||e.stop(),this.audioUpdateListener&&(null===(t=this.participant)||void 0===t||t.removeListener("audioUpdate",this.audioUpdateListener)),this.screenShareUpdateListener&&(null===(i=this.participant)||void 0===i||i.removeListener("screenShareUpdate",this.screenShareUpdateListener))}participantChanged(e){null!=e&&(this.audioUpdateListener=({audioEnabled:e,audioTrack:t})=>{var i;if(null===(i=this.hark)||void 0===i||i.stop(),e&&null!=t){this.audioEnabled=!0;let e=new MediaStream;e.addTrack(t),this.calcVolume(e),c(this.visualizer,0)}else this.volume=0,this.audioEnabled=!1},this.isScreenShare?(this.screenShareUpdateListener=({screenShareEnabled:e,screenShareTracks:t})=>{this.audioUpdateListener({audioEnabled:e&&null!=t.audio,audioTrack:t.audio})},this.screenShareUpdateListener({screenShareEnabled:e.screenShareEnabled,screenShareTracks:{audio:e.screenShareTracks.audio,video:e.screenShareTracks.video}}),e.addListener("screenShareUpdate",this.screenShareUpdateListener)):(this.audioUpdateListener(e),e.addListener("audioUpdate",this.audioUpdateListener)))}calcVolume(e){this.hark=(0,s.h)(e,{play:!1,interval:100}),this.hark.on("volume_change",e=>{let t=this.volume,i=Math.round(10**(e/115)*10);i<3&&(i=0);let a=Math.round((2*t+i)/3);t!==a&&(this.volume=a,c(this.visualizer,this.volume))})}render(){return(0,a.h)(a.H,null,(0,a.h)("canvas",{width:"24",height:"24",class:{bars:!0,visible:this.audioEnabled},ref:e=>this.visualizer=e,part:"canvas"}),!this.isScreenShare&&!this.audioEnabled&&(0,a.h)("dyte-icon",{icon:this.iconPack.mic_off,part:"mic-off-icon",iconPack:this.iconPack,t:this.t}))}static get watchers(){return{participant:["participantChanged"]}}};o.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{display:block;height:var(--dyte-space-6, 24px);width:-moz-fit-content;width:fit-content}canvas,dyte-icon{height:var(--dyte-space-6, 24px);width:var(--dyte-space-6, 24px)}:host([size='sm']){transform:scale(0.9)}canvas{display:none}canvas.visible{display:block}canvas.bars{--tw-text-opacity:1;color:rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-text-opacity))}";let h=class{constructor(e){(0,a.r)(this,e),this.dyteChange=(0,a.c)(this,"dyteChange",4),this.onClick=()=>{!this.readonly&&!this.disabled&&(this.checked=!this.checked)},this.onKeyPress=e=>{if(!this.readonly)switch(e.key){case"Enter":case" ":this.checked=!this.checked}},this.checked=!1,this.readonly=!1,this.disabled=!1,this.iconPack=n.d,this.t=(0,r.u)()}connectedCallback(){this.checkedChange(this.checked)}checkedChange(e){this.checked=e,this.dyteChange.emit(e)}render(){return(0,a.h)(a.H,{role:"switch",tabIndex:this.disabled&&0,"aria-readonly":this.readonly,"aria-checked":this.checked,"aria-disabled":this.disabled,class:{checked:this.checked},onClick:this.onClick,onKeyPress:this.onKeyPress},(0,a.h)("div",{class:"switch",part:"switch"}))}static get watchers(){return{checked:["checkedChange"]}}};h.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}:host{box-sizing:border-box;display:inline-flex;height:var(--dyte-space-6, 24px);width:var(--dyte-space-10, 40px);align-items:center;padding:var(--dyte-space-1, 4px);border-radius:9999px;background-color:rgb(var(--dyte-colors-text-600, 255 255 255 / 0.52));cursor:pointer}.switch{box-sizing:border-box;height:var(--dyte-space-4, 16px);width:var(--dyte-space-4, 16px);background-color:rgb(var(--dyte-colors-text-on-brand-1000, var(--dyte-colors-text-1000, 255 255 255)));border-radius:9999px;transition-property:var(--dyte-transition-property, all);transition-duration:200ms}:host(.checked){--tw-bg-opacity:1;background-color:rgba(var(--dyte-colors-brand-500, 33 96 253) / var(--tw-bg-opacity))}:host(.checked) .switch{transform:translateX(100%)}:host([readonly]),:host([disabled]){cursor:not-allowed;opacity:0.6}"},40566:function(e,t,i){function a(){}i.d(t,{h:function(){return r}}),a.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,i){this.callbacks=this.callbacks||{};var a=3==arguments.length,s=a?arguments[1]:void 0,n=a?arguments[2]:arguments[1];return n._groupName=s,(this.callbacks[e]=this.callbacks[e]||[]).push(n),this},t.once=function(e,t,i){var a=this,s=3==arguments.length,n=s?arguments[1]:void 0,r=s?arguments[2]:arguments[1];return this.on(e,n,function t(){a.off(e,t),r.apply(this,arguments)}),this},t.releaseGroup=function(e){var t,i,a,s;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(i=0,a=(s=this.callbacks[t]).length;i<a;i++)s[i]._groupName===e&&(s.splice(i,1),i--,a--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var i,a=this.callbacks[e];return a?1==arguments.length?(delete this.callbacks[e],this):(-1!==(i=a.indexOf(t))&&(a.splice(i,1),0===a.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,i,a,s=[].slice.call(arguments,1),n=this.callbacks[e],r=this.getWildcardCallbacks(e);if(n)for(t=0,i=(a=n.slice()).length;t<i&&a[t];++t){;a[t].apply(this,s)}if(r)for(t=0,i=r.length,i=(a=r.slice()).length;t<i&&a[t];++t){;a[t].apply(this,[e].concat(s))}return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,i,a=[];for(t in this.callbacks)i=t.split("*"),("*"===t||2===i.length&&e.slice(0,i[0].length)===i[0])&&(a=a.concat(this.callbacks[t]));return a}},a.mixin(a);"undefined"!=typeof window&&(s=window.AudioContext||window.webkitAudioContext);var s,n=null,r=function(e,t){var i,r,c,o=new a;if(!s)return o;var t=t||{},h=t.smoothing||.1,l=t.interval||50,d=t.threshold,u=t.play,p=t.history||10,g=!0;(c=(n=t.audioContext||n||new s).createAnalyser()).fftSize=512,c.smoothingTimeConstant=h,r=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(i=n.createMediaElementSource(e),void 0===u&&(u=!0)):i=n.createMediaStreamSource(e),d=d||-50,i.connect(c),u&&c.connect(n.destination),o.speaking=!1,o.suspend=function(){return n.suspend()},o.resume=function(){return n.resume()},Object.defineProperty(o,"state",{get:function(){return n.state}}),n.onstatechange=function(){o.emit("state_change",n.state)},o.setThreshold=function(e){d=e},o.setInterval=function(e){l=e},o.stop=function(){g=!1,o.emit("volume_change",-100,d),o.speaking&&(o.speaking=!1,o.emit("stopped_speaking")),c.disconnect(),i.disconnect()},o.speakingHistory=[];for(var k=0;k<p;k++)o.speakingHistory.push(0);var f=function(){setTimeout(function(){if(!!g){var e=function(e,t){var i=-1/0;e.getFloatFrequencyData(t);for(var a=4,s=t.length;a<s;a++)t[a]>i&&t[a]<0&&(i=t[a]);return i}(c,r);o.emit("volume_change",e,d);var t=0;if(e>d&&!o.speaking){for(var i=o.speakingHistory.length-3;i<o.speakingHistory.length;i++)t+=o.speakingHistory[i];t>=2&&(o.speaking=!0,o.emit("speaking"))}else if(e<d&&o.speaking){for(var i=0;i<o.speakingHistory.length;i++)t+=o.speakingHistory[i];0==t&&(o.speaking=!1,o.emit("stopped_speaking"))}o.speakingHistory.shift(),o.speakingHistory.push(0+(e>d)),f()}},l)};return f(),o}}}]);