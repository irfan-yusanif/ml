"use strict";(self.webpackChunkdyte_docs=self.webpackChunkdyte_docs||[]).push([["494"],{11029:function(t,e,i){i.d(e,{d:function(){return m}});var s=i(9079),r=/\s/,n=/^\s+/,o=0/0,l=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,h=/^0o[0-7]+$/i,c=parseInt;function d(t){if("number"==typeof t)return t;if("symbol"==typeof(e=t)||(0,s.i)(e)&&"[object Symbol]"==(0,s.b)(e))return o;if((0,s.a)(t)){var e,i,d="function"==typeof t.valueOf?t.valueOf():t;t=(0,s.a)(d)?d+"":d}if("string"!=typeof t)return 0===t?t:+t;t=(i=t)?i.slice(0,function(t){for(var e=t.length;e--&&r.test(t.charAt(e)););return e}(i)+1).replace(n,""):i;var u=a.test(t);return u||h.test(t)?c(t.slice(2),u?2:8):l.test(t)?o:+t}var u=function(){return s.r.Date.now()},g=Math.max,f=Math.min;function m(t,e,i){var r,n,o,l,a,h,c=0,m=!1,v=!1,b=!0;if("function"!=typeof t)throw TypeError("Expected a function");function p(e){var i=r,s=n;return r=n=void 0,c=e,l=t.apply(s,i)}e=d(e)||0,(0,s.a)(i)&&(m=!!i.leading,o=(v="maxWait"in i)?g(d(i.maxWait)||0,e):o,b="trailing"in i?!!i.trailing:b);function y(t){var i=t-h,s=t-c;return void 0===h||i>=e||i<0||v&&s>=o}function S(){var t,i,s,r,n=u();if(y(n))return T(n);a=setTimeout(S,(i=(t=n)-h,s=t-c,r=e-i,v?f(r,o-s):r))}function T(t){return(a=void 0,b&&r)?p(t):(r=n=void 0,l)}function I(){var t,i=u(),s=y(i);if(r=arguments,n=this,h=i,s){if(void 0===a){;return c=t=h,a=setTimeout(S,e),m?p(t):l}if(v)return clearTimeout(a),a=setTimeout(S,e),p(h)}return void 0===a&&(a=setTimeout(S,e)),l}return I.cancel=function(){void 0!==a&&clearTimeout(a),c=0,r=h=n=a=void 0},I.flush=function(){return void 0===a?l:T(u())},I}},82639:function(t,e,i){i.r(e),i.d(e,{dyte_message_list_view:function(){return o}});var s=i(84982);i(39415),i(79598),i(78410);var r=i(48724);i(51943);var n=i(11029);i(94098),i(81479),i(9079);let o=class{constructor(t){(0,s.r)(this,t),this.sizes=new Map,this.lastScrollTop=0,this.scrollToBottomRetries=0,this.elementObserver=(()=>{let t=null,e=()=>t?t:"undefined"!=typeof ResizeObserver?t=new ResizeObserver(t=>{t.forEach(t=>{this.measureElement(t.target,t)})}):null;return{disconnect:()=>{var t;return null===(t=e())||void 0===t?void 0:t.disconnect()},observe:t=>{var i;return null===(i=e())||void 0===i?void 0:i.observe(t,{box:"border-box"})},unobserve:t=>{var i;return null===(i=e())||void 0===i?void 0:i.unobserve(t)}}})(),this.measureElement=(t,e)=>{if(!t)return;let i=t.dataset.id;if(this.sizes.has(i)){this.elementObserver.unobserve(t);return}if(e){let s=e.borderBoxSize[0];if(s&&s.blockSize>0){this.saveItemSize(i,s.blockSize),this.elementObserver.unobserve(t);return}}let s=t.getBoundingClientRect();s.height>0&&this.saveItemSize(i,s.height)},this.getVisibleItems=()=>this.messages.slice(this.range.start,this.range.end+1),this.updateVisibleItems=(t,e)=>{let i=this.messages.length,s=t,r=e;i<=this.visibleItemsCount?(s=0,r=i-1):e-t<this.visibleItemsCount-1&&(s=this.range.end-this.visibleItemsCount+1),this.range.start!==s&&(this.range={start:s,end:r},this.totalHeight=this.getRangeSize(0,i))},this.getEstimatedItemSize=()=>this.estimateItemSize,this.getRangeSize=(t,e)=>{let i=0,s=0;for(let r=t;r<e;r++)i+=(s=this.sizes.get(this.messages[r].id))||this.getEstimatedItemSize();return i},this.getScrollTop=()=>this.$listRef?Math.ceil(this.$listRef.scrollTop):0,this.getClientHeight=()=>this.$listRef?Math.ceil(this.$listRef.clientHeight):0,this.getScrollHeight=()=>this.$listRef?Math.ceil(this.$listRef.scrollHeight):0,this.getItemsScrolled=()=>{let t=this.lastScrollTop;if(t<=0)return 0;let e=0,i=0,s=0,r=this.messages.length;for(;e<=r;){if(i=e+r>>>1,(s=this.getRangeSize(0,i))===t)return i;s<t?e=i+1:s>t&&(r=i-1)}return e>0?--e:0},this.getEndByStart=t=>Math.min(t+this.visibleItemsCount,this.messages.length-1),this.scrollToOffset=t=>{this.$listRef&&(this.$listRef.scrollTop=t)},this.scrollToIndex=t=>{if(t>=this.messages.length-1)this.scrollToBottom();else{let e=t<1?0:this.getRangeSize(0,t);this.scrollToOffset(e)}},this.scrollToBottom=()=>{this.$listEndRef&&(0,s.w)(()=>{this.$listEndRef.scrollIntoView(),this.getScrollHeight()-(this.getScrollTop()+this.getClientHeight())>0&&this.scrollToBottomRetries<10?setTimeout(()=>{this.scrollToBottom()},1e3/60):(this.scrollToBottomRetries=0,this.autoScroll=!0)})},this.handleScroll=async()=>{if(this.isFetching)return;let t=this.getScrollTop(),e=t<this.lastScrollTop||0===t?"UP":"DOWN";if(this.lastScrollTop=t,this.loadMore&&0===t&&"UP"===e&&!1===this.isFetching){this.isFetching=!0;let t=await this.loadMore(this.messages[0]);t&&t.length&&(this.messages=[...t,...this.messages]),this.isFetching=!1}"UP"===e?this.handleTop():"DOWN"===e&&this.handleBottom()},this.handleTop=()=>{let t=this.getItemsScrolled();if(t<=this.range.end-5&&(this.autoScroll=!1),t>this.range.start+5)return;let e=Math.max(this.range.start-5,0);this.updateVisibleItems(e,this.getEndByStart(e))},this.handleBottom=()=>{if(this.getItemsScrolled()<this.range.start+5)return;let t=this.range.start+5,e=this.getEndByStart(t);e===this.messages.length-1?this.updateVisibleItems(e-this.visibleItemsCount,e):this.updateVisibleItems(t,e)},this.updateTotalHeight=(0,n.d)(()=>{this.totalHeight=this.getRangeSize(0,this.messages.length)},1e3/30,{leading:!0}),this.rendererInternal=(t,e,i)=>{if(!t||t.dataset.id===e.id)return;let s=this.renderer(e,i);t.hasChildNodes&&(t.innerHTML=""),this.elementObserver.observe(t),t.dataset.id=e.id,t.appendChild(s)},this.messages=void 0,this.renderer=void 0,this.loadMore=void 0,this.visibleItemsCount=20,this.estimateItemSize=100,this.iconPack=r.d,this.range=void 0,this.isFetching=!1,this.autoScroll=!0,this.totalHeight=0}connectedCallback(){let t=this.messages.length-1;this.range={start:t-this.visibleItemsCount,end:t},this.updateVisibleItems(this.range.start,this.range.end),this.totalHeight=this.getRangeSize(0,t)}componentDidLoad(){this.autoScroll&&this.scrollToBottom()}messagesUpdated(t,e){if(t.length>e.length){let i=t.length-e.length;this.updateVisibleItems(i,this.getEndByStart(i)),this.scrollToIndex(this.range.start)}}saveItemSize(t,e){this.sizes.set(t,Math.round(e)),this.updateTotalHeight()}render(){return(0,s.h)("div",{class:"scrollbar content-wrapper",ref:t=>this.$listRef=t,onScroll:this.handleScroll},(0,s.h)("div",{class:"scroller"},(0,s.h)("div",{style:{height:`${this.totalHeight}px`}}),(0,s.h)("div",{class:"smallest-dom-element",id:"list-end",ref:t=>this.$listEndRef=t})),(0,s.h)("div",{class:"content",style:{transform:`translateY(${this.getRangeSize(0,this.range.start)}px)`}},this.isFetching&&(0,s.h)("div",{class:"loader"},(0,s.h)("dyte-spinner",{size:"md"})),this.getVisibleItems().map((t,e)=>(0,s.h)("div",{key:t.id,ref:i=>this.rendererInternal(i,t,e)}))))}static get watchers(){return{messages:["messagesUpdated"]}}};o.style=":host{line-height:initial;font-family:var(--dyte-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--dyte-space-0, 0px);padding:var(--dyte-space-0, 0px)}.scrollbar{scrollbar-width:thin;scrollbar-color:var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))\n    var(--dyte-scrollbar-background, transparent)}.scrollbar::-webkit-scrollbar{height:var(--dyte-space-1\\.5, 6px);width:var(--dyte-space-1\\.5, 6px);border-radius:9999px;background-color:var(--dyte-scrollbar-background, transparent)}.scrollbar::-webkit-scrollbar-thumb{border-radius:9999px;background-color:var(--dyte-scrollbar-color, rgb(var(--dyte-colors-background-600, 60 60 60)))}.loading{cursor:wait}.content-wrapper{height:100%;overflow-y:auto;position:relative;contain:strict}.scroller{width:1px;opacity:0}.content{position:absolute;top:0;width:100%}.smallest-dom-element{width:100%;height:2px;background:red}.loader{margin-top:var(--dyte-space-2, 8px);margin-bottom:var(--dyte-space-2, 8px);display:flex;justify-content:center}"},9079:function(t,e,i){i.d(e,{S:function(){return o},a:function(){return f},b:function(){return g},f:function(){return s},i:function(){return m},r:function(){return n}});var s="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,r="object"==typeof self&&self&&self.Object===Object&&self,n=s||r||Function("return this")(),o=n.Symbol,l=Object.prototype,a=l.hasOwnProperty,h=l.toString,c=o?o.toStringTag:void 0,d=Object.prototype.toString,u=o?o.toStringTag:void 0;function g(t){var e;if(null==t)return void 0===t?"[object Undefined]":"[object Null]";return u&&u in Object(t)?function(t){var e=a.call(t,c),i=t[c];try{t[c]=void 0;var s=!0}catch(t){}var r=h.call(t);return s&&(e?t[c]=i:delete t[c]),r}(t):(e=t,d.call(e))}function f(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function m(t){return null!=t&&"object"==typeof t}}}]);